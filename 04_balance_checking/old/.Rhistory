###############################################################################
# Project: Causal black carbon on birth weight in MA                          #
# Code: Balance checking after weighting                                      #
# Code : (GBM example) from three non-overlapping periods                     #
# Input: clean birth data, bc averages and weights                            #
# Output: balance checking plot                                               #
# Author: Shuxin Dong                                                         #
# Date: Sep 17, 2020                                                          #
###############################################################################
############################# 0. Setup ########################################
rm(list = ls())
gc()
library(weights)
library(radiant)
library(dplyr)
dir_input1 <- "/Users/shuxind/Desktop/BC_birthweight_data/" # change
dir_input2 <- "/Users/shuxind/Desktop/BC_birthweight_analysis/04_GPS_calc_weights/for_time_period/result/"
dir_output <- "/Users/shuxind/Desktop/BC_birthweight_analysis/05_balance_checking/result/" # change
new_plot_name <- "balance_checking_timeperiods.png"
## load data
birth <- readRDS(paste0(dir_input1, "birth_tfm.rds"))
birth <- birth %>% select(-bwg, -bc_30d)
bc <- readRDS(paste0(dir_input2, "gbm_bc_wt.rds"))
############################# 1. functions to calculated weighted corr ########
# weighted standardized difference
wtdstdmdiff <- function(data){
sd_bc_30d <- sd(data$bc_30d)
sd_bc_3090d <- sd(data$bc_3090d)
sd_bc_90280d <- sd(data$bc_90280d)
meansex <- data %>% group_by(sex) %>% summarise(mean_bc_30d=weighted.mean(bc_30d, w=wt_bc_30d), mean_bc_3090d=weighted.mean(bc_3090d, w=wt_bc_3090d), mean_bc_90280d=weighted.mean(bc_90280d, w=wt_bc_90280d)) %>% ungroup()
sex <- c(diff(meansex$mean_bc_30d)/sd_bc_30d, diff(meansex$mean_bc_3090d)/sd_bc_3090d, diff(meansex$mean_bc_90280d)/sd_bc_90280d)
meanmarried <- data %>% group_by(married) %>% summarise(mean_bc_30d=weighted.mean(bc_30d, w=wt_bc_30d), mean_bc_3090d=weighted.mean(bc_3090d, w=wt_bc_3090d), mean_bc_90280d=weighted.mean(bc_90280d, w=wt_bc_90280d)) %>% ungroup()
married <- c(diff(meanmarried$mean_bc_30d)/sd_bc_30d, diff(meanmarried$mean_bc_3090d)/sd_bc_3090d, diff(meanmarried$mean_bc_90280d)/sd_bc_90280d)
meanpncgov <- data %>% group_by(pncgov) %>% summarise(mean_bc_30d=weighted.mean(bc_30d, w=wt_bc_30d), mean_bc_3090d=weighted.mean(bc_3090d, w=wt_bc_3090d), mean_bc_90280d=weighted.mean(bc_90280d, w=wt_bc_90280d)) %>% ungroup()
pncgov <- c(diff(meanpncgov$mean_bc_30d)/sd_bc_30d, diff(meanpncgov$mean_bc_3090d)/sd_bc_3090d, diff(meanpncgov$mean_bc_90280d)/sd_bc_90280d)
meanrf_db_gest <- data %>% group_by(rf_db_gest) %>% summarise(mean_bc_30d=weighted.mean(bc_30d, w=wt_bc_30d), mean_bc_3090d=weighted.mean(bc_3090d, w=wt_bc_3090d), mean_bc_90280d=weighted.mean(bc_90280d, w=wt_bc_90280d)) %>% ungroup()
rf_db_gest <- c(diff(meanrf_db_gest$mean_bc_30d)/sd_bc_30d, diff(meanrf_db_gest$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_db_gest$mean_bc_90280d)/sd_bc_90280d)
meanrf_db_other <- data %>% group_by(rf_db_other) %>% summarise(mean_bc_30d=weighted.mean(bc_30d, w=wt_bc_30d), mean_bc_3090d=weighted.mean(bc_3090d, w=wt_bc_3090d), mean_bc_90280d=weighted.mean(bc_90280d, w=wt_bc_90280d)) %>% ungroup()
rf_db_other <- c(diff(meanrf_db_other$mean_bc_30d)/sd_bc_30d, diff(meanrf_db_other$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_db_other$mean_bc_90280d)/sd_bc_90280d)
meanrf_hbp_chronic <- data %>% group_by(rf_hbp_chronic) %>% summarise(mean_bc_30d=weighted.mean(bc_30d, w=wt_bc_30d), mean_bc_3090d=weighted.mean(bc_3090d, w=wt_bc_3090d), mean_bc_90280d=weighted.mean(bc_90280d, w=wt_bc_90280d)) %>% ungroup()
rf_hbp_chronic <- c(diff(meanrf_hbp_chronic$mean_bc_30d)/sd_bc_30d, diff(meanrf_hbp_chronic$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_hbp_chronic$mean_bc_90280d)/sd_bc_90280d)
meanrf_hbp_pregn <- data %>% group_by(rf_hbp_pregn) %>% summarise(mean_bc_30d=weighted.mean(bc_30d, w=wt_bc_30d), mean_bc_3090d=weighted.mean(bc_3090d, w=wt_bc_3090d), mean_bc_90280d=weighted.mean(bc_90280d, w=wt_bc_90280d)) %>% ungroup()
rf_hbp_pregn <- c(diff(meanrf_hbp_pregn$mean_bc_30d)/sd_bc_30d, diff(meanrf_hbp_pregn$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_hbp_pregn$mean_bc_90280d)/sd_bc_90280d)
meanrf_cervix <- data %>% group_by(rf_cervix) %>% summarise(mean_bc_30d=weighted.mean(bc_30d, w=wt_bc_30d), mean_bc_3090d=weighted.mean(bc_3090d, w=wt_bc_3090d), mean_bc_90280d=weighted.mean(bc_90280d, w=wt_bc_90280d)) %>% ungroup()
rf_cervix <- c(diff(meanrf_cervix$mean_bc_30d)/sd_bc_30d, diff(meanrf_cervix$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_cervix$mean_bc_90280d)/sd_bc_90280d)
meanrf_prev_4kg <- data %>% group_by(rf_prev_4kg) %>% summarise(mean_bc_30d=weighted.mean(bc_30d, w=wt_bc_30d), mean_bc_3090d=weighted.mean(bc_3090d, w=wt_bc_3090d), mean_bc_90280d=weighted.mean(bc_90280d, w=wt_bc_90280d)) %>% ungroup()
rf_prev_4kg <- c(diff(meanrf_prev_4kg$mean_bc_30d)/sd_bc_30d, diff(meanrf_prev_4kg$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_prev_4kg$mean_bc_90280d)/sd_bc_90280d)
meanrf_prev_sga <- data %>% group_by(rf_prev_sga) %>% summarise(mean_bc_30d=weighted.mean(bc_30d, w=wt_bc_30d), mean_bc_3090d=weighted.mean(bc_3090d, w=wt_bc_3090d), mean_bc_90280d=weighted.mean(bc_90280d, w=wt_bc_90280d)) %>% ungroup()
rf_prev_sga <- c(diff(meanrf_prev_sga$mean_bc_30d)/sd_bc_30d, diff(meanrf_prev_sga$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_prev_sga$mean_bc_90280d)/sd_bc_90280d)
wtdstdmdiff <- rbind(sex, married, pncgov, rf_db_gest, rf_db_other, rf_hbp_chronic, rf_hbp_pregn, rf_cervix, rf_prev_4kg, rf_prev_sga)
colnames(wtdstdmdiff) <- c("stdmdiff_30d","stdmdiff_3090d","stdmdiff_90280d")
return(wtdstdmdiff)
}
# weighted  correlation
wtdcorr <- function(data){
mage <- c(wtd.cor(data$mage, data$bc_30d, weight = data$wt_bc_30d)[1],wtd.cor(data$mage, data$bc_3090d, weight = data$wt_bc_3090d)[1],wtd.cor(data$mage, data$bc_90280d, weight = data$wt_bc_90280d)[1])
cigddp <- c(wtd.cor(data$cigddp, data$bc_30d, weight = data$wt_bc_30d)[1],wtd.cor(data$cigddp, data$bc_3090d, weight = data$wt_bc_3090d)[1],wtd.cor(data$cigddp, data$bc_90280d, weight = data$wt_bc_90280d)[1])
cigdpp <- c(wtd.cor(data$cigdpp, data$bc_30d, weight = data$wt_bc_30d)[1],wtd.cor(data$cigdpp, data$bc_3090d, weight = data$wt_bc_3090d)[1],wtd.cor(data$cigdpp, data$bc_90280d, weight = data$wt_bc_90280d)[1])
clinega <- c(wtd.cor(data$clinega, data$bc_30d, weight = data$wt_bc_30d)[1],wtd.cor(data$clinega, data$bc_3090d, weight = data$wt_bc_3090d)[1],wtd.cor(data$clinega, data$bc_90280d, weight = data$wt_bc_90280d)[1])
log_med_hs_inc <- c(wtd.cor(data$log_med_hs_inc, data$bc_30d, weight = data$wt_bc_30d)[1],wtd.cor(data$log_med_hs_inc, data$bc_3090d, weight = data$wt_bc_3090d)[1],wtd.cor(data$log_med_hs_inc, data$bc_90280d, weight = data$wt_bc_90280d)[1])
wtdcorr <- rbind(mage, cigddp, cigdpp, clinega, log_med_hs_inc)
colnames(wtdcorr) <- c("wtdcorr_30d", "wtdcorr_3090d", "wtdcorr_280d")
return(wtdcorr)
}
# un-weighted standardized difference
stdmdiff <- function(data){
sd_bc_30d <- sd(data$bc_30d)
sd_bc_3090d <- sd(data$bc_3090d)
sd_bc_90280d <- sd(data$bc_90280d)
meansex <- data %>% group_by(sex) %>% summarise(mean_bc_30d=mean(bc_30d), mean_bc_3090d=mean(bc_3090d), mean_bc_90280d=mean(bc_90280d)) %>% ungroup()
sex <- c(diff(meansex$mean_bc_30d)/sd_bc_30d, diff(meansex$mean_bc_3090d)/sd_bc_3090d, diff(meansex$mean_bc_90280d)/sd_bc_90280d)
meanmarried <- data %>% group_by(married) %>% summarise(mean_bc_30d=mean(bc_30d), mean_bc_3090d=mean(bc_3090d), mean_bc_90280d=mean(bc_90280d)) %>% ungroup()
married <- c(diff(meanmarried$mean_bc_30d)/sd_bc_30d, diff(meanmarried$mean_bc_3090d)/sd_bc_3090d, diff(meanmarried$mean_bc_90280d)/sd_bc_90280d)
meanpncgov <- data %>% group_by(pncgov) %>% summarise(mean_bc_30d=mean(bc_30d), mean_bc_3090d=mean(bc_3090d), mean_bc_90280d=mean(bc_90280d)) %>% ungroup()
pncgov <- c(diff(meanpncgov$mean_bc_30d)/sd_bc_30d, diff(meanpncgov$mean_bc_3090d)/sd_bc_3090d, diff(meanpncgov$mean_bc_90280d)/sd_bc_90280d)
meanrf_db_gest <- data %>% group_by(rf_db_gest) %>% summarise(mean_bc_30d=mean(bc_30d), mean_bc_3090d=mean(bc_3090d), mean_bc_90280d=mean(bc_90280d)) %>% ungroup()
rf_db_gest <- c(diff(meanrf_db_gest$mean_bc_30d)/sd_bc_30d, diff(meanrf_db_gest$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_db_gest$mean_bc_90280d)/sd_bc_90280d)
meanrf_db_other <- data %>% group_by(rf_db_other) %>% summarise(mean_bc_30d=mean(bc_30d), mean_bc_3090d=mean(bc_3090d), mean_bc_90280d=mean(bc_90280d)) %>% ungroup()
rf_db_other <- c(diff(meanrf_db_other$mean_bc_30d)/sd_bc_30d, diff(meanrf_db_other$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_db_other$mean_bc_90280d)/sd_bc_90280d)
meanrf_hbp_chronic <- data %>% group_by(rf_hbp_chronic) %>% summarise(mean_bc_30d=mean(bc_30d), mean_bc_3090d=mean(bc_3090d), mean_bc_90280d=mean(bc_90280d)) %>% ungroup()
rf_hbp_chronic <- c(diff(meanrf_hbp_chronic$mean_bc_30d)/sd_bc_30d, diff(meanrf_hbp_chronic$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_hbp_chronic$mean_bc_90280d)/sd_bc_90280d)
meanrf_hbp_pregn <- data %>% group_by(rf_hbp_pregn) %>% summarise(mean_bc_30d=mean(bc_30d), mean_bc_3090d=mean(bc_3090d), mean_bc_90280d=mean(bc_90280d)) %>% ungroup()
rf_hbp_pregn <- c(diff(meanrf_hbp_pregn$mean_bc_30d)/sd_bc_30d, diff(meanrf_hbp_pregn$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_hbp_pregn$mean_bc_90280d)/sd_bc_90280d)
meanrf_cervix <- data %>% group_by(rf_cervix) %>% summarise(mean_bc_30d=mean(bc_30d), mean_bc_3090d=mean(bc_3090d), mean_bc_90280d=mean(bc_90280d)) %>% ungroup()
rf_cervix <- c(diff(meanrf_cervix$mean_bc_30d)/sd_bc_30d, diff(meanrf_cervix$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_cervix$mean_bc_90280d)/sd_bc_90280d)
meanrf_prev_4kg <- data %>% group_by(rf_prev_4kg) %>% summarise(mean_bc_30d=mean(bc_30d), mean_bc_3090d=mean(bc_3090d), mean_bc_90280d=mean(bc_90280d)) %>% ungroup()
rf_prev_4kg <- c(diff(meanrf_prev_4kg$mean_bc_30d)/sd_bc_30d, diff(meanrf_prev_4kg$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_prev_4kg$mean_bc_90280d)/sd_bc_90280d)
meanrf_prev_sga <- data %>% group_by(rf_prev_sga) %>% summarise(mean_bc_30d=mean(bc_30d), mean_bc_3090d=mean(bc_3090d), mean_bc_90280d=mean(bc_90280d)) %>% ungroup()
rf_prev_sga <- c(diff(meanrf_prev_sga$mean_bc_30d)/sd_bc_30d, diff(meanrf_prev_sga$mean_bc_3090d)/sd_bc_3090d, diff(meanrf_prev_sga$mean_bc_90280d)/sd_bc_90280d)
stdmdiff <- rbind(sex, married, pncgov, rf_db_gest, rf_db_other, rf_hbp_chronic, rf_hbp_pregn, rf_cervix, rf_prev_4kg, rf_prev_sga)
colnames(stdmdiff) <- c("stdmdiff_30d","stdmdiff_3090d","stdmdiff_90280d")
return(stdmdiff)
}
# un-weighted correlation
corr <- function(data){
mage <- c(cor(data$mage, data$bc_30d), cor(data$mage, data$bc_3090d), cor(data$mage, data$bc_90280d))
cigddp <- c(cor(data$cigddp, data$bc_30d), cor(data$cigddp, data$bc_3090d), cor(data$cigddp, data$bc_90280d))
cigdpp <- c(cor(data$cigdpp, data$bc_30d), cor(data$cigdpp, data$bc_3090d), cor(data$cigdpp, data$bc_90280d))
clinega <- c(cor(data$clinega, data$bc_30d), cor(data$clinega, data$bc_3090d), cor(data$clinega, data$bc_90280d))
log_med_hs_inc <- c(cor(data$log_med_hs_inc, data$bc_30d), cor(data$log_med_hs_inc, data$bc_3090d), cor(data$log_med_hs_inc, data$bc_90280d))
corr <- rbind(mage, cigddp, cigdpp, clinega, log_med_hs_inc)
colnames(corr) <- c("corr_30d", "corr_3090d", "corr_90280d")
return(corr)
}
############################# 2. calculation ##################################
birth_wt <- left_join(bc, birth, by = "uniqueid_yr")
remove(bc)
remove(birth)
gc()
# calculate balances without weighting
unwtd_stdmdiff <- stdmdiff(birth_wt)
unwtd_corr <- corr(birth_wt)
unwtd_stdmdiff <- as.data.frame(unwtd_stdmdiff)
unwtd_corr <- as.data.frame(unwtd_corr)
# calculate balances with weighting
wtd_stdmdiff <- wtdstdmdiff(birth_wt)
wtd_corr <- wtdcorr(birth_wt)
wtd_stdmdiff <- as.data.frame(wtd_stdmdiff)
wtd_corr <- as.data.frame(wtd_corr)
bc_30d <- c(cor(data$bc_30d, data$bc_30d), cor(data$bc_30d, data$bc_3090d), cor(data$bc_30d, data$bc_90280d))
bc_30d <- c(cor(birth_wt$bc_30d, birth_wt$bc_30d), cor(birth_wt$bc_30d, birth_wt$bc_3090d), cor(birth_wt$bc_30d, birth_wt$bc_90280d))
bc_3090d <- c(cor(birth_wt$bc_3090d, birth_wt$bc_30d), cor(birth_wt$bc_30d, birth_wt$bc_3090d), cor(birth_wt$bc_3090d, birth_wt$bc_90280d))
bc_90280d <- c(cor(birth_wt$bc_90280d, birth_wt$bc_30d), cor(birth_wt$bc_90280d, birth_wt$bc_3090d), cor(birth_wt$bc_90280d, birth_wt$bc_90280d))
rbind(unwtd_corr, bc_30d, bc_3090d, bc_90280d)
bc_30d <- c(wtd.cor(birth_wt$bc_30d, birth_wt$bc_30d, weight = birth_wt$wt_bc_30d)[1],wtd.cor(birth_wt$bc_30d, birth_wt$bc_3090d, weight = birth_wt$wt_bc_3090d)[1],wtd.cor(birth_wt$bc_30d, birth_wt$bc_90280d, weight = birth_wt$wt_bc_90280d)[1])
rbind(wtd_corr,
bc_30d <- c(wtd.cor(birth_wt$bc_30d, birth_wt$bc_30d, weight = birth_wt$wt_bc_30d)[1],wtd.cor(birth_wt$bc_30d, birth_wt$bc_3090d, weight = birth_wt$wt_bc_3090d)[1],wtd.cor(birth_wt$bc_30d, birth_wt$bc_90280d, weight = birth_wt$wt_bc_90280d)[1]),
bc_3090d <- c(wtd.cor(birth_wt$bc_3090d, birth_wt$bc_30d, weight = birth_wt$wt_bc_30d)[1],wtd.cor(birth_wt$bc_3090d, birth_wt$bc_3090d, weight = birth_wt$wt_bc_3090d)[1],wtd.cor(birth_wt$bc_3090d, birth_wt$bc_90280d, weight = birth_wt$wt_bc_90280d)[1]),
bc_90280d <- c(wtd.cor(birth_wt$bc_90280d, birth_wt$bc_30d, weight = birth_wt$wt_bc_30d)[1],wtd.cor(birth_wt$bc_90280d, birth_wt$bc_3090d, weight = birth_wt$wt_bc_3090d)[1],wtd.cor(birth_wt$bc_90280d, birth_wt$bc_90280d, weight = birth_wt$wt_bc_90280d)[1])
)
wtd_corr <- rbind(wtd_corr,
bc_30d <- c(wtd.cor(birth_wt$bc_30d, birth_wt$bc_30d, weight = birth_wt$wt_bc_30d)[1],wtd.cor(birth_wt$bc_30d, birth_wt$bc_3090d, weight = birth_wt$wt_bc_3090d)[1],wtd.cor(birth_wt$bc_30d, birth_wt$bc_90280d, weight = birth_wt$wt_bc_90280d)[1]),
bc_3090d <- c(wtd.cor(birth_wt$bc_3090d, birth_wt$bc_30d, weight = birth_wt$wt_bc_30d)[1],wtd.cor(birth_wt$bc_3090d, birth_wt$bc_3090d, weight = birth_wt$wt_bc_3090d)[1],wtd.cor(birth_wt$bc_3090d, birth_wt$bc_90280d, weight = birth_wt$wt_bc_90280d)[1]),
bc_90280d <- c(wtd.cor(birth_wt$bc_90280d, birth_wt$bc_30d, weight = birth_wt$wt_bc_30d)[1],wtd.cor(birth_wt$bc_90280d, birth_wt$bc_3090d, weight = birth_wt$wt_bc_3090d)[1],wtd.cor(birth_wt$bc_90280d, birth_wt$bc_90280d, weight = birth_wt$wt_bc_90280d)[1])
)
unwtd_corr <- rbind(unwtd_corr,
bc_30d <- c(cor(birth_wt$bc_30d, birth_wt$bc_30d), cor(birth_wt$bc_30d, birth_wt$bc_3090d), cor(birth_wt$bc_30d, birth_wt$bc_90280d)),
bc_3090d <- c(cor(birth_wt$bc_3090d, birth_wt$bc_30d), cor(birth_wt$bc_30d, birth_wt$bc_3090d), cor(birth_wt$bc_3090d, birth_wt$bc_90280d)),
bc_90280d <- c(cor(birth_wt$bc_90280d, birth_wt$bc_30d), cor(birth_wt$bc_90280d, birth_wt$bc_3090d), cor(birth_wt$bc_90280d, birth_wt$bc_90280d))
)
############################# 3. draw balance plots ###########################
# get covariates names as a list
xvarlabel <- append(row.names(unwtd_stdmdiff),row.names(unwtd_corr), "bc_30d", "bc_3090d", "bc_90280d")
############################# 3. draw balance plots ###########################
# get covariates names as a list
xvarlabel <- append(row.names(unwtd_stdmdiff), row.names(unwtd_corr), c("bc_30d", "bc_3090d", "bc_90280d"))
row.names(unwtd_stdmdiff)
?append
############################# 3. draw balance plots ###########################
# get covariates names as a list
xvarlabel <- append(row.names(unwtd_stdmdiff), row.names(unwtd_corr))
xvarlabel <- append(xvarlabel,c("bc_30d", "bc_3090d", "bc_90280d"))
xvarlabel
# combine standardized difference and correlation
balance_unwtd <- append(unwtd_stdmdiff$stdmdiff_30d,unwtd_corr$corr_30d)
row.names(unwtd_corr)
row.names(unwtd_corr)[6]
row.names(unwtd_corr)[6] <- "bc_30d"
row.names(unwtd_corr)[6] <- "bc_30d"
row.names(unwtd_corr)[6] <- "bc_30d"
row.names(unwtd_corr)[7] <- "bc_3090d"
row.names(unwtd_corr)[8] <- "bc_90280d"
row.names(wtd_corr)[6] <- "bc_30d"
row.names(wtd_corr)[7] <- "bc_3090d"
row.names(wtd_corr)[8] <- "bc_90280d"
############################# 3. draw balance plots ###########################
# get covariates names as a list
xvarlabel <- append(row.names(unwtd_stdmdiff), row.names(unwtd_corr))
# combine standardized difference and correlation
balance_unwtd <- append(unwtd_stdmdiff$stdmdiff_30d,unwtd_corr$corr_30d)
balance_wtd <- append(wtd_stdmdiff$stdmdiff_30d,wtd_corr$wtdcorr_30d)
xvar <- append(c(-1:-15),c(-1:-15))
xvar <- append(c(-1:-18),c(-1:-18))
balance <- append(balance_unwtd, balance_wtd)
series <- append(rep(4,15),rep(2,15))
plot <- as.data.frame(cbind(xvar,balance,series))
label_plot <- c("% Female", "% Married", "% Goverment support for prenatal care",
"% Gestational diabetes", "% Maternal diabetes",
"% Maternal chronic high blood pressure",
"% Gestational high blood pressure",
"% Maternal incompetent cervix",
"% Mothers with previous infant over 4000 g",
"% Mother with previous SGA infants", "Mother's Age",
"Smoking during pregnancy", "Smoking before pregnancy",
"Clinical gestational age", "Log. median household income")
series <- append(rep(4,15),rep(2,15))
xvar <- append(c(-1:-18),c(-1:-18))
balance <- append(balance_unwtd, balance_wtd)
series <- append(rep(4,15),rep(2,15))
plot <- as.data.frame(cbind(xvar,balance,series))
series <- append(rep(4,18),rep(2,18))
plot <- as.data.frame(cbind(xvar,balance,series))
label_plot <- c("% Female", "% Married", "% Goverment support for prenatal care",
"% Gestational diabetes", "% Maternal diabetes",
"% Maternal chronic high blood pressure",
"% Gestational high blood pressure",
"% Maternal incompetent cervix",
"% Mothers with previous infant over 4000 g",
"% Mother with previous SGA infants", "Mother's Age",
"Smoking during pregnancy", "Smoking before pregnancy",
"Clinical gestational age", "Log. median household income")
par(mai=c(1, 3.5, 0.4, 2))
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-16)),
xlim = range(c(-0.25,0.25)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Standardized Difference/Correlation Coefficient"
)
grid(nx = 10, ny = 16, col = "lightgray", lty = 1,
lwd = par("lwd"), equilogs = TRUE)
abline(v = 0, col = 1)
axis(2, at=-1:-15, labels=label_plot,lty=0, las=1)
axis(1, at=c(-0.2,-0.15,-0.10,-0.05,0,0.05,0.10,0.15,0.2), labels=c(-0.2,-0.15,-0.10,-0.05,0,0.05,0.10,0.15,0.2),lty=0, las=1)
legend("topright",legend = c("Unweighted","Weighted"), pch = 16, col = c(4,2), bty = "n",inset=c(-0.7,0),xpd=TRUE)
# get covariates names as a list
xvarlabel <- append(row.names(unwtd_stdmdiff), row.names(unwtd_corr))
# combine standardized difference and correlation
balance_unwtd <- append(unwtd_stdmdiff$stdmdiff_30d,unwtd_corr$corr_30d)
balance_wtd <- append(wtd_stdmdiff$stdmdiff_30d,wtd_corr$wtdcorr_30d)
xvar <- append(c(-1:-18),c(-1:-18))
balance <- append(balance_unwtd, balance_wtd)
series <- append(rep(4,18),rep(2,18))
plot <- as.data.frame(cbind(xvar,balance,series))
label_plot <- c("% Female", "% Married", "% Goverment support for prenatal care",
"% Gestational diabetes", "% Maternal diabetes",
"% Maternal chronic high blood pressure",
"% Gestational high blood pressure",
"% Maternal incompetent cervix",
"% Mothers with previous infant over 4000 g",
"% Mother with previous SGA infants", "Mother's Age",
"Smoking during pregnancy", "Smoking before pregnancy",
"Clinical gestational age", "Log. median household income")
par(mai=c(1, 3.5, 0.4, 2))
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-16)),
xlim = range(c(-0.25,0.25)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Standardized Difference/Correlation Coefficient"
)
grid(nx = 10, ny = 16, col = "lightgray", lty = 1,
lwd = par("lwd"), equilogs = TRUE)
abline(v = 0, col = 1)
axis(2, at=-1:-15, labels=label_plot,lty=0, las=1)
axis(1, at=c(-0.2,-0.15,-0.10,-0.05,0,0.05,0.10,0.15,0.2), labels=c(-0.2,-0.15,-0.10,-0.05,0,0.05,0.10,0.15,0.2),lty=0, las=1)
label_plot <- c("% Female", "% Married", "% Goverment support for prenatal care",
"% Gestational diabetes", "% Maternal diabetes",
"% Maternal chronic high blood pressure",
"% Gestational high blood pressure",
"% Maternal incompetent cervix",
"% Mothers with previous infant over 4000 g",
"% Mother with previous SGA infants", "Mother's Age",
"Smoking during pregnancy", "Smoking before pregnancy",
"Clinical gestational age", "Log. median household income",
"bc_30d", "bc_3090d", "bc_90280d")
par(mai=c(1, 3.5, 0.4, 2))
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-16)),
xlim = range(c(-0.25,0.25)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Standardized Difference/Correlation Coefficient"
)
View(plot)
par(mai=c(1, 3.5, 0.4, 2))
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-19)),
xlim = range(c(-0.25,0.25)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Standardized Difference/Correlation Coefficient"
)
par(mai=c(1, 3.5, 1, 1))
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-19)),
xlim = range(c(-0.25,0.25)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Standardized Difference/Correlation Coefficient"
)
############################# 3. draw balance plots ###########################
# get covariates names as a list
xvarlabel <- append(row.names(unwtd_stdmdiff), row.names(unwtd_corr))
# combine standardized difference and correlation
balance_unwtd <- append(unwtd_stdmdiff$stdmdiff_30d,unwtd_corr$corr_30d)
balance_wtd <- append(wtd_stdmdiff$stdmdiff_30d,wtd_corr$wtdcorr_30d)
xvar <- append(c(-1:-18),c(-1:-18))
balance <- append(balance_unwtd, balance_wtd)
series <- append(rep(4,18),rep(2,18))
plot <- as.data.frame(cbind(xvar,balance,series))
label_plot <- c("% Female", "% Married", "% Goverment support for prenatal care",
"% Gestational diabetes", "% Maternal diabetes",
"% Maternal chronic high blood pressure",
"% Gestational high blood pressure",
"% Maternal incompetent cervix",
"% Mothers with previous infant over 4000 g",
"% Mother with previous SGA infants", "Mother's Age",
"Smoking during pregnancy", "Smoking before pregnancy",
"Clinical gestational age", "Log. median household income",
"bc_30d", "bc_3090d", "bc_90280d")
par(mai=c(1, 3.5, 1, 1))
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-19)),
xlim = range(c(-1,1)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Standardized Difference/Correlation Coefficient"
)
###### for each time periods
unwtd_corr_bc <- rbind(
bc_30d <- c(cor(birth_wt$bc_30d, birth_wt$bc_30d), cor(birth_wt$bc_30d, birth_wt$bc_3090d), cor(birth_wt$bc_30d, birth_wt$bc_90280d)),
bc_3090d <- c(cor(birth_wt$bc_3090d, birth_wt$bc_30d), cor(birth_wt$bc_30d, birth_wt$bc_3090d), cor(birth_wt$bc_3090d, birth_wt$bc_90280d)),
bc_90280d <- c(cor(birth_wt$bc_90280d, birth_wt$bc_30d), cor(birth_wt$bc_90280d, birth_wt$bc_3090d), cor(birth_wt$bc_90280d, birth_wt$bc_90280d))
)
unwtd_corr_bc <- rbind(
bc_30d <- c(cor(birth_wt$bc_30d, birth_wt$bc_30d), cor(birth_wt$bc_30d, birth_wt$bc_3090d), cor(birth_wt$bc_30d, birth_wt$bc_90280d)),
bc_3090d <- c(cor(birth_wt$bc_3090d, birth_wt$bc_30d), cor(birth_wt$bc_30d, birth_wt$bc_3090d), cor(birth_wt$bc_3090d, birth_wt$bc_90280d)),
bc_90280d <- c(cor(birth_wt$bc_90280d, birth_wt$bc_30d), cor(birth_wt$bc_90280d, birth_wt$bc_3090d), cor(birth_wt$bc_90280d, birth_wt$bc_90280d))
)
row.names(unwtd_corr_bc) <- c("bc_30d", "bc_3090d", "bc_90280d")
wtd_corr_bc <- rbind(
bc_30d <- c(wtd.cor(birth_wt$bc_30d, birth_wt$bc_30d, weight = birth_wt$wt_bc_30d)[1],wtd.cor(birth_wt$bc_30d, birth_wt$bc_3090d, weight = birth_wt$wt_bc_3090d)[1],wtd.cor(birth_wt$bc_30d, birth_wt$bc_90280d, weight = birth_wt$wt_bc_90280d)[1]),
bc_3090d <- c(wtd.cor(birth_wt$bc_3090d, birth_wt$bc_30d, weight = birth_wt$wt_bc_30d)[1],wtd.cor(birth_wt$bc_3090d, birth_wt$bc_3090d, weight = birth_wt$wt_bc_3090d)[1],wtd.cor(birth_wt$bc_3090d, birth_wt$bc_90280d, weight = birth_wt$wt_bc_90280d)[1]),
bc_90280d <- c(wtd.cor(birth_wt$bc_90280d, birth_wt$bc_30d, weight = birth_wt$wt_bc_30d)[1],wtd.cor(birth_wt$bc_90280d, birth_wt$bc_3090d, weight = birth_wt$wt_bc_3090d)[1],wtd.cor(birth_wt$bc_90280d, birth_wt$bc_90280d, weight = birth_wt$wt_bc_90280d)[1])
)
row.names(wtd_corr_bc) <- c("bc_30d", "bc_3090d", "bc_90280d")
# combine standardized difference and correlation
balance_unwtd <- unwtd_corr_bc[,1]
balance_wtd <- wtd_corr_bc[,1]
# get covariates names as a list
xvarlabel <- row.names(unwtd_corr_bc)
xvar <- append(c(-1:-3),c(-1:-3))
balance <- append(balance_unwtd, balance_wtd)
series <- append(rep(4,3),rep(2,3))
plot <- as.data.frame(cbind(xvar,balance,series))
label_plot <- c(                "bc_30d", "bc_3090d", "bc_90280d")
par(mai=c(1, 3.5, 1, 1))
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-19)),
xlim = range(c(-1,1)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Standardized Difference/Correlation Coefficient"
)
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-4)),
xlim = range(c(-1,1)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Standardized Difference/Correlation Coefficient"
)
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-4)),
xlim = range(c(-1,1)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Standardized Difference/Correlation Coefficient"
)
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-4)),
xlim = range(c(-1.2,1.2)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Standardized Difference/Correlation Coefficient"
)
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-4)),
xlim = range(c(-1.2,1.2)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Correlation Coefficient"
)
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-4)),
xlim = range(c(-1.2,1.2)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Correlation Coefficient"
)
grid(nx = 10, ny = 16, col = "lightgray", lty = 1,
lwd = par("lwd"), equilogs = TRUE)
abline(v = 0, col = 1)
axis(2, at=-1:-15, labels=label_plot,lty=0, las=1)
axis(1, at=c(-0.2,-0.15,-0.10,-0.05,0,0.05,0.10,0.15,0.2), labels=c(-0.2,-0.15,-0.10,-0.05,0,0.05,0.10,0.15,0.2),lty=0, las=1)
par(mai=c(0.2, 3.5, 0.2, 0.2))
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-4)),
xlim = range(c(-1.2,1.2)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Correlation Coefficient"
)
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-4)),
xlim = range(c(-1.2,1.2)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Correlation Coefficient"
)
par(mai=c(1, 3.5, 1, 1))
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-4)),
xlim = range(c(-1.2,1.2)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Correlation Coefficient"
)
grid(nx = 10, ny = 16, col = "lightgray", lty = 1,
lwd = par("lwd"), equilogs = TRUE)
abline(v = 0, col = 1)
axis(2, at=-1:-15, labels=label_plot,lty=0, las=1)
axis(1, at=c(-0.2,-0.15,-0.10,-0.05,0,0.05,0.10,0.15,0.2), labels=c(-0.2,-0.15,-0.10,-0.05,0,0.05,0.10,0.15,0.2),lty=0, las=1)
label_plot <- c(                "bc_30d", "bc_3090d", "bc_90280d")
par(mai=c(1, 3.5, 1, 1))
label_plot <- c("bc_30d", "bc_3090d", "bc_90280d")
par(mai=c(1, 3.5, 1, 1))
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-4)),
xlim = range(c(-1.2,1.2)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Correlation Coefficient"
)
grid(nx = 10, ny = 16, col = "lightgray", lty = 1,
lwd = par("lwd"), equilogs = TRUE)
abline(v = 0, col = 1)
axis(2, at=-1:-3, labels=label_plot,lty=0, las=1)
axis(1, at=c(-0.2,-0.15,-0.10,-0.05,0,0.05,0.10,0.15,0.2), labels=c(-0.2,-0.15,-0.10,-0.05,0,0.05,0.10,0.15,0.2),lty=0, las=1)
par(mai=c(1, 2, 1, 1))
plot(x=plot$balance, y=plot$xvar,
col=plot$series,pch=16,
ylim = range(c(-0,-4)),
xlim = range(c(-1.2,1.2)),
xaxs = "i", yaxs = "i",
bty="n" ,
xaxt = "n", yaxt = "n",
ylab = "", xlab="Correlation Coefficient"
)
grid(nx = 10, ny = 16, col = "lightgray", lty = 1,
lwd = par("lwd"), equilogs = TRUE)
abline(v = 0, col = 1)
axis(2, at=-1:-3, labels=label_plot,lty=0, las=1)
axis(1, at=c(-0.2,-0.15,-0.10,-0.05,0,0.05,0.10,0.15,0.2), labels=c(-0.2,-0.15,-0.10,-0.05,0,0.05,0.10,0.15,0.2),lty=0, las=1)
axis(1, at=c(-1,-0.8,-0.6,-0.4,-0.2,0,0.2,0.4,0.6,0.8,1), labels=c(-1,-0.8,-0.6,-0.4,-0.2,0,0.2,0.4,0.6,0.8,1),lty=0, las=1)
rm(list=ls())
gc()
qui()
quit()
