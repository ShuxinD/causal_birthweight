############################# 0. Setup ########################################
rm(list = ls())
gc()
library(dplyr)
library(data.table)
dir_input <- "/Users/shuxind/Desktop/PercentbelowPoverty_tract_2000_2015/"
dir_output <- "/Users/shuxind/Desktop/PercentbelowPoverty_tract_2000_2015/clean/"
####################### 4. take care of 2010, 2011, 2009 #######################
poverty_2010 <- fread(file = paste0(dir_input,
"nhgis0005_ds176_20105_2010_tract.csv"),
select = c("GISJOIN", "STATE", "NAME_E", "JOCE001", "JOCE002", "JOCE003"),
header = T, na.strings = "-")
poverty_2000(STATE=="Massachusetts")
poverty_2000[STATE=="Massachusetts"]
poverty_2010[STATE=="Massachusetts"]
poverty_2010 <- poverty_2010[STATE=="Massachusetts"]
poverty_2010 <- poverty_2010 %>% mutate(percentPoverty = (JOCE002+JOCE003)/JOCE001)
poverty_2010 <- poverty_2010 %>% mutate(percentPoverty = (JOCE002+JOCE003)/JOCE001*100)
####################### 4. take care of 2010, 2011, 2009 #######################
poverty_2010 <- fread(file = paste0(dir_input,
"nhgis0005_ds176_20105_2010_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "JOCE001",
"JOCE002", "JOCE003"),
header = T, na.strings = "-")
poverty_2010 <- poverty_2010[STATE=="Massachusetts"]
########################### 3. take care of 2000 ###############################
poverty_2000 <- fread(text = paste0(dir_input,"poverty2000.csv"),
colClasses = c("character", "double"),
col.names = c("areakey", "propPoverty"),
na.strings = ".")
poverty_2000 <- poverty_2000 %>% mutate(state = substr(areakey,1,2),
percentPoverty = propPoverty*100) %>%
filter(state == "25") %>% # MA's state code
mutate(tract = substr(areakey, 6, 11))
########################### 3. take care of 2000 ###############################
poverty_2000 <- fread(text = paste0(dir_input,"poverty2000.csv"),
colClasses = c("character", "double"),
col.names = c("areakey", "propPoverty"),
na.strings = ".")
poverty_2000 <- poverty_2000 %>% mutate(state = substr(areakey,1,2),
percentPoverty = propPoverty*100) %>%
filter(state == "25") %>% # MA's state code
mutate(tract = substr(areakey, 6, 11))
########################### 3. take care of 2000 ###############################
poverty_2000 <- fread(text = paste0(dir_input,"poverty2000.csv"),
colClasses = c("character", "double"),
col.names = c("areakey", "propPoverty"),
na.strings = ".")
poverty_2000 <- poverty_2000 %>% mutate(state = substr(areakey,1,2),
percentPoverty = propPoverty*100) %>%
filter(state == "25") %>% # MA's state code
mutate(tract = substr(areakey, 6, 11))
write_data(poverty_2000)
############################# 2. save new data ################################
write_data <- function(poverty) {
write.csv(poverty, file = paste0(dir_output,"percentPoverty",
deparse(substitute(poverty)),".csv"))
}
write_data(poverty_2000)
rm(poverty_2000)
####################### 4. take care of 2010, 2011, 2009 #######################
poverty_2010 <- fread(file = paste0(dir_input,
"nhgis0005_ds176_20105_2010_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "JOCE001",
"JOCE002", "JOCE003"),
header = T)#, na.strings = "-")
####################### 4. take care of 2010, 2011, 2009 #######################
poverty_2010 <- fread(file = paste0(dir_input,
"nhgis0005_ds176_20105_2010_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "JOCE001",
"JOCE002", "JOCE003"),
header = T, na.strings = "-")
poverty_2010 <- poverty_2010[STATE=="Massachusetts"]
poverty_2010 <- poverty_2010 %>% mutate(percentPoverty = (JOCE002+JOCE003)/JOCE001)
poverty_2010 <- poverty_2010 %>% mutate(percentPoverty = (JOCE002+JOCE003)/JOCE001) %>%
select(-JOCE001, -JOCE002, -JOCE003)
####################### 4. take care of 2010, 2011, 2009 #######################
poverty_2010 <- fread(file = paste0(dir_input,
"nhgis0005_ds176_20105_2010_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "JOCE001",
"JOCE002", "JOCE003"),
header = T, na.strings = "-")
poverty_2010 <- poverty_2010[STATE=="Massachusetts"]
poverty_2010 <- poverty_2010 %>% mutate(percentPoverty = (JOCE002+JOCE003)/JOCE001*100) %>%
select(-JOCE001, -JOCE002, -JOCE003)
####################### 4. take care of 2010, 2011, 2009 #######################
poverty_2010 <- fread(file = paste0(dir_input,
"nhgis0005_ds176_20105_2010_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "JOCE001",
"JOCE002", "JOCE003"),
header = T, na.strings = "-")
poverty_2010 <- poverty_2010[STATE=="Massachusetts"]
poverty_2010 <- poverty_2010 %>% mutate(percentPoverty = (JOCE002+JOCE003)/JOCE001*100,
tract = substr(GISJOIN,9,14)) %>%
select(-JOCE001, -JOCE002, -JOCE003)
headers <- c("GISJOIN", "STATE", "STATEA", "NAME", "percentPoverty", "tract")
colnames(df) <- headers
colnames(poverty_2010) <- headers
op_on_NHGIS <- function(poverty){
poverty <- poverty[STATE=="Massachusetts"]
poverty <- poverty %>% mutate(percentPoverty = (JOCE002+JOCE003)/JOCE001*100,
tract = substr(GISJOIN,9,14)) %>%
select(-JOCE001, -JOCE002, -JOCE003)
headers <- c("GISJOIN", "STATE", "STATEA", "NAME", "percentPoverty", "tract")
colnames(poverty) <- headers
}
####################### 4. take care of 2010, 2011, 2009 #######################
poverty_2010 <- fread(file = paste0(dir_input,
"nhgis0005_ds176_20105_2010_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "JOCE001",
"JOCE002", "JOCE003"),
header = T, na.strings = "-")
poverty_2010 <- op_on_NHGIS(poverty_2010)
op_on_NHGIS <- function(poverty){
poverty <- poverty[STATE=="Massachusetts"]
poverty <- poverty %>% mutate(percentPoverty = (JOCE002+JOCE003)/JOCE001*100,
tract = substr(GISJOIN,9,14)) %>%
select(-JOCE001, -JOCE002, -JOCE003)
headers <- c("GISJOIN", "STATE", "STATEA", "NAME", "percentPoverty", "tract")
colnames(poverty) <- headers
return(poverty)
}
####################### 4. take care of 2010, 2011, 2009 #######################
poverty_2010 <- fread(file = paste0(dir_input,
"nhgis0005_ds176_20105_2010_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "JOCE001",
"JOCE002", "JOCE003"),
header = T, na.strings = "-")
op_on_NHGIS <- function(poverty){
poverty <- poverty[STATE=="Massachusetts"]
poverty <- poverty %>% mutate(percentPoverty = (JOCE002+JOCE003)/JOCE001*100,
tract = substr(GISJOIN,9,14)) %>%
select(-JOCE001, -JOCE002, -JOCE003)
headers <- c("GISJOIN", "STATE", "STATEA", "NAME", "percentPoverty", "tract")
colnames(poverty) <- headers
return(poverty)
}
poverty_2010 <- op_on_NHGIS(poverty_2010)
####################### 4. take care of 2010, 2011, 2009 #######################
poverty_2010 <- fread(file = paste0(dir_input,
"nhgis0005_ds176_20105_2010_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "JOCE001",
"JOCE002", "JOCE003"),
header = T, na.strings = "-")
poverty_2011 <- fread(file = paste0(dir_input,
"nhgis0005_ds184_20115_2011_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "JOCE001",
"JOCE002", "JOCE003"),
header = T, na.strings = "-")
poverty_2009 <- fread(file = paste0(dir_input,
"nhgis0005_ds195_20095_2009_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "JOCE001",
"JOCE002", "JOCE003"),
header = T, na.strings = "-")
####################### 4. take care of 2010, 2011, 2009 #######################
poverty_2010 <- fread(file = paste0(dir_input,
"nhgis0005_ds176_20105_2010_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "JOCE001",
"JOCE002", "JOCE003"),
header = T, na.strings = "-")
poverty_2011 <- fread(file = paste0(dir_input,
"nhgis0005_ds184_20115_2011_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "MPVE001",
"MPVE002", "MPVE003"),
header = T, na.strings = "-")
poverty_2009 <- fread(file = paste0(dir_input,
"nhgis0005_ds195_20095_2009_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "RNBE001",
"RNBE002", "RNBE003"),
header = T, na.strings = "-")
op_on_NHGIS <- function(poverty){
poverty <- poverty[STATE=="Massachusetts"]
poverty <- poverty %>% mutate(percentPoverty = (JOCE002+JOCE003)/JOCE001*100,
tract = substr(GISJOIN,9,14)) %>%
select(-c(5:7))
headers <- c("GISJOIN", "STATE", "STATEA", "NAME", "percentPoverty", "tract")
colnames(poverty) <- headers
return(poverty)
}
poverty_2010 <- op_on_NHGIS(poverty_2010)
poverty_2011 <- op_on_NHGIS(poverty_2011)
op_on_NHGIS <- function(poverty){
poverty <- poverty[STATE=="Massachusetts"]
poverty <- poverty %>% mutate(percentPoverty = (.[[6]]+.[[7]])/.[[5]]*100,
tract = substr(GISJOIN,9,14)) %>%
select(-c(5:7))
headers <- c("GISJOIN", "STATE", "STATEA", "NAME", "percentPoverty", "tract")
colnames(poverty) <- headers
return(poverty)
}
####################### 4. take care of 2010, 2011, 2009 #######################
poverty_2010 <- fread(file = paste0(dir_input,
"nhgis0005_ds176_20105_2010_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "JOCE001",
"JOCE002", "JOCE003"),
header = T, na.strings = "-")
poverty_2011 <- fread(file = paste0(dir_input,
"nhgis0005_ds184_20115_2011_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "MPVE001",
"MPVE002", "MPVE003"),
header = T, na.strings = "-")
poverty_2009 <- fread(file = paste0(dir_input,
"nhgis0005_ds195_20095_2009_tract.csv"),
select = c("GISJOIN", "STATE", "STATEA", "NAME_E", "RNBE001",
"RNBE002", "RNBE003"),
header = T, na.strings = "-")
op_on_NHGIS <- function(poverty){
poverty <- poverty[STATE=="Massachusetts"]
poverty <- poverty %>% mutate(percentPoverty = (.[[6]]+.[[7]])/.[[5]]*100,
tract = substr(GISJOIN,9,14)) %>%
select(-c(5:7))
headers <- c("GISJOIN", "STATE", "STATEA", "NAME", "percentPoverty", "tract")
colnames(poverty) <- headers
return(poverty)
}
poverty_2010 <- op_on_NHGIS(poverty_2010)
poverty_2011 <- op_on_NHGIS(poverty_2011)
poverty_2010 <- op_on_NHGIS(poverty_2010)
poverty_2009 <- op_on_NHGIS(poverty_2009)
############################# 2. save new data ################################
write_data <- function(poverty) {
write.csv(poverty, file = paste0(dir_output,"percentPoverty",
deparse(substitute(poverty)),".csv"))
}
write_data(poverty_2010)
write_data(poverty_2011)
write_data(poverty_2009)
############################# 0. Setup ########################################
rm(list = ls())
gc()
